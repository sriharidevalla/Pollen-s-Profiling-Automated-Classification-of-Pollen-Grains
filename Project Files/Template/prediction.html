<!DOCTYPE html>
<html class="light dark" lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Pollen Profiling - Prediction</title>

  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com" rel="preconnect"/>
  <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;900&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>

  <style>
    .btn-gradient {
      background-image: linear-gradient(to right, #2ecc71, #ffda63);
      transition: all 0.3s ease-in-out;
    }
    .btn-gradient:hover {
      box-shadow: 0 0 20px rgba(46, 204, 113, 0.6);
      transform: scale(1.03);
    }
    .upload-box {
      border: 2px dashed rgba(255, 255, 255, 0.15);
      border-radius: 1rem;
      transition: all 0.3s ease-in-out;
      background-color: rgba(255, 255, 255, 0.04);
      width: 100%;
      max-width: 100%;
      padding: 2rem 1.5rem;
    }
    .upload-box:hover {
      border-color: #2ecc71;
      background-color: rgba(46, 204, 113, 0.1);
    }
    .content-card {
      background: rgba(255, 255, 255, 0.06);
      border-radius: 1.25rem;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      box-shadow: 0 4px 25px rgba(0, 0, 0, 0.3);
      padding: 2rem 2rem;
      width: 100%;
      max-width: 1100px;
    }
  </style>

  <script id="tailwind-config">
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#25d46e",
            "background-light": "#f6f8f7",
            "background-dark": "#122018",
            "text-light": "#1e1e1e",
            "text-dark": "#fdfdfd",
            "gold": "#ffda63",
            "emerald": "#2ecc71"
          },
          fontFamily: {
            "display": ["Poppins", "sans-serif"]
          }
        },
      },
    }
  </script>
</head>

<body class="font-display bg-background-dark text-text-dark flex items-center justify-center min-h-screen px-4">
  <div class="content-card flex flex-col items-center justify-center gap-6 text-center">

    <!-- Heading -->
    <div>
      <h1 class="text-4xl font-extrabold mb-1">Pollen Grain Classification</h1>
      <p class="text-gray-300 text-sm">Upload a microscope image to instantly identify the pollen type.</p>
    </div>

    <!-- Upload Form -->
    <form method="POST" enctype="multipart/form-data" class="flex flex-col w-full items-center gap-4">
      <label for="file-upload" class="upload-box flex flex-col items-center justify-center cursor-pointer">
        <span class="material-symbols-outlined text-6xl text-gray-400 dark:text-gray-300 mb-2">cloud_upload</span>
        <p class="text-base font-semibold text-gray-200 mb-1">Drag & Drop Image Here</p>
        <p class="text-sm text-gray-400 mb-2">or click below to select a file from your computer</p>
        <span class="btn-gradient px-5 py-2 rounded-full text-sm text-black font-semibold">Browse Files</span>
        <input id="file-upload" name="file" type="file" accept=".jpg,.jpeg,.png" class="hidden" required onchange="showFileName(event)">
      </label>

      <div id="file-name" class="text-gray-300 text-sm font-medium hidden"></div>

      <button type="submit" class="btn-gradient mt-2 h-11 px-10 rounded-full text-black text-sm font-bold uppercase tracking-wide shadow-lg">
        Predict
      </button>
    </form>

    <!-- Prediction Display -->
    {% if prediction %}
    <div class="mt-6 bg-black/20 rounded-xl p-5 flex flex-col items-center w-full max-w-md mx-auto shadow-lg">
      <img class="w-48 h-48 object-cover rounded-lg border border-gray-700 mb-3"
           src="{{ url_for('uploaded_file', filename=prediction.img_file) }}"
           alt="Uploaded pollen grain image" />
      <p class="text-xl font-bold text-emerald-400">{{ prediction.predicted_type }}</p>
      <p class="text-sm text-gray-300">Confidence: {{ (prediction.confidence * 100) | round(2) }}%</p>
    </div>
    {% elif error %}
    <div class="text-red-400 font-semibold mt-3">{{ error }}</div>
    {% endif %}
  </div>

  <script>
    function showFileName(event) {
      const fileList = event.target.files;
      const fileNameDiv = document.getElementById("file-name");
      if (fileList.length > 0) {
        fileNameDiv.innerText = fileList[0].name + " (" + Math.round(fileList[0].size / 1024) + " KB)";
        fileNameDiv.classList.remove("hidden");
      }
    }
  </script>
</body>
</html>
